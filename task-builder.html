<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVA3 • Construtor de Tarefas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="./assets/css/chrome.css">
    <link rel="stylesheet" href="./assets/css/admin.css">
    <link rel="stylesheet" href="./assets/css/editor-styles.css">
</head>
<body class="bg-light">

    <div id="site-header"></div>
    <div id="site-sidebar"></div>

    <main class="page-content">
        <div class="container-fluid p-4">

            <div class="d-flex align-items-center gap-3 mb-4">
                <button id="btn-back" class="btn btn-white border shadow-sm rounded-circle p-2">
                    <i class='bx bx-arrow-back fs-4'></i>
                </button>
                <div class="flex-grow-1">
                    <h6 class="text-muted fw-bold mb-0 small d-flex align-items-center gap-1" id="task-hierarchy">...</h6>
                    <h3 class="fw-bold text-dark mb-0" id="task-title">Carregando...</h3>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <div class="text-end lh-1 bg-white px-3 py-2 rounded border">
                        <small class="text-muted d-block fw-bold" style="font-size: 0.7rem;">TOTAL</small>
                        <span class="text-primary fw-bold fs-5" id="total-points-display">0</span> <span class="small text-muted">pts</span>
                    </div>
                    <button class="btn btn-success fw-bold px-4 shadow-sm" onclick="saveTask()" id="btn-save">
                        <i class='bx bx-save me-1'></i> Salvar Atividade
                    </button>
                </div>
            </div>

            <div class="row justify-content-center">
                <div class="col-lg-8">
                    
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white py-3 border-bottom">
                            <h6 class="fw-bold mb-0 text-dark"><i class='bx bx-info-circle me-2'></i> Instruções Gerais da Atividade</h6>
                        </div>
                        <div class="card-body p-3">
                            <textarea id="task-instructions" class="form-control" rows="3" placeholder="Descreva o objetivo geral desta tarefa..."></textarea>
                        </div>
                    </div>

                    <h6 class="text-muted fw-bold text-uppercase small mb-3 ps-1 d-flex justify-content-between align-items-center">
                        <span>Questões & Itens de Resposta</span>
                        <span class="badge bg-light text-dark border" id="items-count">0 itens</span>
                    </h6>
                    
                    <div id="task-list" class="d-flex flex-column gap-3 mb-5"></div>

                    <div class="card border-2 border-dashed bg-transparent text-center p-4">
                        <p class="text-muted small fw-bold mb-3 text-uppercase">Adicionar Nova Questão</p>
                        <div class="row g-3 justify-content-center">
                            <div class="col-md-5">
                                <button class="btn btn-white border shadow-sm w-100 py-3 d-flex align-items-center justify-content-center gap-2 hover-shadow" onclick="window.addTaskItem('text')">
                                    <i class='bx bx-paragraph fs-3 text-primary'></i>
                                    <div class="text-start">
                                        <div class="fw-bold text-dark">Dissertativa</div>
                                        <small class="text-muted" style="font-size: 0.7rem;">Aluno escreve texto</small>
                                    </div>
                                </button>
                            </div>
                            <div class="col-md-5">
                                <button class="btn btn-white border shadow-sm w-100 py-3 d-flex align-items-center justify-content-center gap-2 hover-shadow" onclick="window.addTaskItem('link')">
                                    <i class='bx bx-cloud-upload fs-3 text-success'></i>
                                    <div class="text-start">
                                        <div class="fw-bold text-dark">Envio de Arquivo</div>
                                        <small class="text-muted" style="font-size: 0.7rem;">Aluno envia link/anexo</small>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
                
                <div class="col-lg-4">
                    <div class="alert alert-info border-0 shadow-sm small">
                        <h6 class="fw-bold"><i class='bx bx-bulb'></i> Dicas de Edição</h6>
                        <ul class="mb-0 ps-3">
                            <li>Use os botões <strong><i class='bx bx-chevron-up'></i></strong> e <strong><i class='bx bx-chevron-down'></i></strong> para reordenar as questões.</li>
                            <li>Defina a <strong>pontuação</strong> de cada item. O sistema calcula o total automaticamente.</li>
                            <li>Você pode <strong>colorir textos</strong> importantes no enunciado.</li>
                            <li>Adicione links de materiais de apoio direto na pergunta.</li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <template id="tpl-task-item">
        <div class="card task-item-card shadow-sm mb-3">
            <div class="card-header bg-white py-2 px-3 border-bottom d-flex align-items-center justify-content-between">
                
                <div class="d-flex align-items-center gap-2">
                    <div class="order-actions me-2">
                        <button class="btn btn-move btn-move-up" title="Mover para cima"><i class='bx bx-chevron-up'></i></button>
                        <button class="btn btn-move btn-move-down" title="Mover para baixo"><i class='bx bx-chevron-down'></i></button>
                    </div>
                    <span class="badge bg-dark item-number">#1</span>
                    <span class="fw-bold text-uppercase small text-muted item-type-label">Dissertativa</span>
                </div>

                <div class="d-flex align-items-center gap-3">
                    <div class="input-group input-group-sm points-input-group">
                        <span class="input-group-text bg-light fw-bold text-muted">Pts</span>
                        <input type="number" class="form-control text-center fw-bold text-primary item-points" value="0" min="0" step="0.5">
                    </div>
                    <button class="btn btn-sm btn-outline-danger border-0 btn-delete" title="Remover Questão"><i class='bx bx-trash fs-5'></i></button>
                </div>
            </div>

            <div class="card-body p-3">
                
                <div class="mb-3">
                    <label class="form-label fw-bold small text-muted">ENUNCIADO DA QUESTÃO</label>
                    <div class="rich-editor-container">
                        <div class="rich-toolbar">
                            <button type="button" class="rich-btn" data-cmd="bold" title="Negrito"><b>B</b></button>
                            <button type="button" class="rich-btn" data-cmd="italic" title="Itálico"><i>I</i></button>
                            <button type="button" class="rich-btn" data-cmd="underline" title="Sublinhado"><u>U</u></button>
                            <div class="vr mx-1"></div>
                            <input type="color" class="form-control form-control-color p-0 border-0 rich-color" style="width:25px; height:25px;" title="Cor do Texto">
                            <div class="vr mx-1"></div>
                            <button type="button" class="rich-btn" data-cmd="createLink" title="Inserir Link"><i class='bx bx-link'></i></button>
                            <button type="button" class="rich-btn" data-cmd="removeFormat" title="Limpar Formatação"><i class='bx bx-eraser'></i></button>
                        </div>
                        <div class="rich-content" contenteditable="true" placeholder="Digite a pergunta aqui..."></div>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold small text-muted"><i class='bx bx-paperclip'></i> MATERIAL DE APOIO (OPCIONAL)</label>
                    <input type="url" class="form-control form-control-sm item-resource" placeholder="Cole um link de PDF, Imagem ou Drive para auxiliar o aluno...">
                </div>

                <div class="p-3 bg-light rounded border border-dashed opacity-75 preview-area">
                    </div>
            </div>
        </div>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="./assets/js/chrome.js"></script>
    <script type="module" src="./assets/js/task-builder.js"></script>
</body>
</html>